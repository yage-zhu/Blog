<!DOCTYPE html>
<html lang="zh" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>03 【Fetch】 | yage</title>
    <meta name="description" content="yage Blog">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/assets/style.DpHQPELj.css" as="style">
    
    <script type="module" src="/assets/app.BJ0HA5hI.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.D0GxZxa-.js">
    <link rel="modulepreload" href="/assets/chunks/framework.7ep0oyv4.js">
    <link rel="modulepreload" href="/assets/ajax_3.md.BVB_7yCr.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"dark",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-2fdd469f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-9bbe40e8></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-9bbe40e8> Skip to content </a><!--]--><!----><header class="VPNav" data-v-2fdd469f data-v-2981abac><div class="VPNavBar has-sidebar top" data-v-2981abac data-v-e8abc852><div class="wrapper" data-v-e8abc852><div class="container" data-v-e8abc852><div class="title" data-v-e8abc852><div class="VPNavBarTitle has-sidebar" data-v-e8abc852 data-v-0a1dc046><a class="title" href="/" data-v-0a1dc046><!--[--><!--]--><!--[--><img class="VPImage logo" src="/stars.png" alt data-v-d4169a1c><!--]--><span data-v-0a1dc046>yage</span><!--[--><!--]--></a></div></div><div class="content" data-v-e8abc852><div class="content-body" data-v-e8abc852><!--[--><!--]--><div class="VPNavBarSearch search" data-v-e8abc852><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-e8abc852 data-v-e5bdfb67><span id="main-nav-aria-label" class="visually-hidden" data-v-e5bdfb67>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-e5bdfb67 data-v-4f62c62c><!--[--><span data-v-4f62c62c>Home</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e5bdfb67 data-v-52b91f0c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-52b91f0c><span class="text" data-v-52b91f0c><!----><span data-v-52b91f0c>前端</span><span class="vpi-chevron-down text-icon" data-v-52b91f0c></span></span></button><div class="menu" data-v-52b91f0c><div class="VPMenu" data-v-52b91f0c data-v-e98d092d><div class="items" data-v-e98d092d><!--[--><!--[--><div class="VPMenuLink" data-v-e98d092d data-v-2ce5f666><a class="VPLink link" href="/html/1.html" data-v-2ce5f666><!--[-->HTML<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e98d092d data-v-2ce5f666><a class="VPLink link" href="/css/1.html" data-v-2ce5f666><!--[-->CSS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e98d092d data-v-2ce5f666><a class="VPLink link" href="/javascript/1.html" data-v-2ce5f666><!--[-->JavaScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e98d092d data-v-2ce5f666><a class="VPLink link" href="/ajax/1.html" data-v-2ce5f666><!--[-->ajax<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e98d092d data-v-2ce5f666><a class="VPLink link" href="/less%20and%20scss/1.html" data-v-2ce5f666><!--[-->less and scss<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e98d092d data-v-2ce5f666><a class="VPLink link" href="/typescript/1.html" data-v-2ce5f666><!--[-->TypeScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e98d092d data-v-2ce5f666><a class="VPLink link" href="/vue3/1.html" data-v-2ce5f666><!--[-->Vue3<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e98d092d data-v-2ce5f666><a class="VPLink link" href="/browser/1.html" data-v-2ce5f666><!--[-->浏览器工作原理<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e5bdfb67 data-v-52b91f0c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-52b91f0c><span class="text" data-v-52b91f0c><!----><span data-v-52b91f0c>安全</span><span class="vpi-chevron-down text-icon" data-v-52b91f0c></span></span></button><div class="menu" data-v-52b91f0c><div class="VPMenu" data-v-52b91f0c data-v-e98d092d><div class="items" data-v-e98d092d><!--[--><!--[--><div class="VPMenuLink" data-v-e98d092d data-v-2ce5f666><a class="VPLink link" href="/kali/1.html" data-v-2ce5f666><!--[-->Kali<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e98d092d data-v-2ce5f666><a class="VPLink link" href="/network%20security/1.html" data-v-2ce5f666><!--[-->网络安全<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e98d092d data-v-2ce5f666><a class="VPLink link" href="/security%20devices/1.html" data-v-2ce5f666><!--[-->安全设备<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/python/1.html" tabindex="0" data-v-e5bdfb67 data-v-4f62c62c><!--[--><span data-v-4f62c62c>Python</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/nodejs/1.html" tabindex="0" data-v-e5bdfb67 data-v-4f62c62c><!--[--><span data-v-4f62c62c>Nodejs</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/git/1.html" tabindex="0" data-v-e5bdfb67 data-v-4f62c62c><!--[--><span data-v-4f62c62c>Git</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/linux/1.html" tabindex="0" data-v-e5bdfb67 data-v-4f62c62c><!--[--><span data-v-4f62c62c>Linux</span><!--]--></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-e8abc852 data-v-8c529fcf data-v-52b91f0c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-52b91f0c><span class="text" data-v-52b91f0c><span class="vpi-languages option-icon" data-v-52b91f0c></span><!----><span class="vpi-chevron-down text-icon" data-v-52b91f0c></span></span></button><div class="menu" data-v-52b91f0c><div class="VPMenu" data-v-52b91f0c data-v-e98d092d><!----><!--[--><!--[--><div class="items" data-v-8c529fcf><p class="title" data-v-8c529fcf>中文</p><!--[--><div class="VPMenuLink" data-v-8c529fcf data-v-2ce5f666><a class="VPLink link" href="/en/ajax/3.html" data-v-2ce5f666><!--[-->English<!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-e8abc852 data-v-dba25ce5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-dba25ce5 data-v-1a5707b1 data-v-bcb971ab><span class="check" data-v-bcb971ab><span class="icon" data-v-bcb971ab><!--[--><span class="vpi-sun sun" data-v-1a5707b1></span><span class="vpi-moon moon" data-v-1a5707b1></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-e8abc852 data-v-1fe946d0 data-v-49c0bd2e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/yage-zhu" aria-label="github" target="_blank" rel="noopener" data-v-49c0bd2e data-v-78639b0a><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-e8abc852 data-v-79512190 data-v-52b91f0c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-52b91f0c><span class="vpi-more-horizontal icon" data-v-52b91f0c></span></button><div class="menu" data-v-52b91f0c><div class="VPMenu" data-v-52b91f0c data-v-e98d092d><!----><!--[--><!--[--><div class="group translations" data-v-79512190><p class="trans-title" data-v-79512190>中文</p><!--[--><div class="VPMenuLink" data-v-79512190 data-v-2ce5f666><a class="VPLink link" href="/en/ajax/3.html" data-v-2ce5f666><!--[-->English<!--]--></a></div><!--]--></div><div class="group" data-v-79512190><div class="item appearance" data-v-79512190><p class="label" data-v-79512190>Appearance</p><div class="appearance-action" data-v-79512190><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-79512190 data-v-1a5707b1 data-v-bcb971ab><span class="check" data-v-bcb971ab><span class="icon" data-v-bcb971ab><!--[--><span class="vpi-sun sun" data-v-1a5707b1></span><span class="vpi-moon moon" data-v-1a5707b1></span><!--]--></span></span></button></div></div></div><div class="group" data-v-79512190><div class="item social-links" data-v-79512190><div class="VPSocialLinks social-links-list" data-v-79512190 data-v-49c0bd2e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/yage-zhu" aria-label="github" target="_blank" rel="noopener" data-v-49c0bd2e data-v-78639b0a><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-e8abc852 data-v-6d92cf19><span class="container" data-v-6d92cf19><span class="top" data-v-6d92cf19></span><span class="middle" data-v-6d92cf19></span><span class="bottom" data-v-6d92cf19></span></span></button></div></div></div></div><div class="divider" data-v-e8abc852><div class="divider-line" data-v-e8abc852></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-2fdd469f data-v-18c7a066><div class="container" data-v-18c7a066><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-18c7a066><span class="vpi-align-left menu-icon" data-v-18c7a066></span><span class="menu-text" data-v-18c7a066>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-18c7a066 data-v-636ac860><button data-v-636ac860>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-2fdd469f data-v-4e63ba98><div class="curtain" data-v-4e63ba98></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-4e63ba98><span class="visually-hidden" id="sidebar-aria-label" data-v-4e63ba98> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-4e63ba98><section class="VPSidebarItem level-0 has-active" data-v-4e63ba98 data-v-a0363abd><div class="item" role="button" tabindex="0" data-v-a0363abd><div class="indicator" data-v-a0363abd></div><h2 class="text" data-v-a0363abd>目录</h2><!----></div><div class="items" data-v-a0363abd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a0363abd data-v-a0363abd><div class="item" data-v-a0363abd><div class="indicator" data-v-a0363abd></div><a class="VPLink link link" href="/ajax/1.html" data-v-a0363abd><!--[--><p class="text" data-v-a0363abd>01 【AJAX】</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a0363abd data-v-a0363abd><div class="item" data-v-a0363abd><div class="indicator" data-v-a0363abd></div><a class="VPLink link link" href="/ajax/2.html" data-v-a0363abd><!--[--><p class="text" data-v-a0363abd>02【Axios】</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a0363abd data-v-a0363abd><div class="item" data-v-a0363abd><div class="indicator" data-v-a0363abd></div><a class="VPLink link link" href="/ajax/3.html" data-v-a0363abd><!--[--><p class="text" data-v-a0363abd>03 【Fetch】</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a0363abd data-v-a0363abd><div class="item" data-v-a0363abd><div class="indicator" data-v-a0363abd></div><a class="VPLink link link" href="/ajax/4.html" data-v-a0363abd><!--[--><p class="text" data-v-a0363abd>04 【跨域初识】</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-2fdd469f data-v-0c35d42f><div class="VPDoc has-sidebar has-aside" data-v-0c35d42f data-v-2295edbf><!--[--><!--]--><div class="container" data-v-2295edbf><div class="aside" data-v-2295edbf><div class="aside-curtain" data-v-2295edbf></div><div class="aside-container" data-v-2295edbf><div class="aside-content" data-v-2295edbf><div class="VPDocAside" data-v-2295edbf data-v-22c997c5><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" role="navigation" data-v-22c997c5 data-v-07e68753><div class="content" data-v-07e68753><div class="outline-marker" data-v-07e68753></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-07e68753>On this page</div><ul class="VPDocOutlineItem root" data-v-07e68753 data-v-2d8a325d><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-22c997c5></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-2295edbf><div class="content-container" data-v-2295edbf><!--[--><!--]--><main class="main" data-v-2295edbf><div style="position:relative;" class="vp-doc _ajax_3" data-v-2295edbf><div><h1 id="_03-【fetch】" tabindex="-1">03 【Fetch】 <a class="header-anchor" href="#_03-【fetch】" aria-label="Permalink to &quot;03 【Fetch】&quot;">​</a></h1><h2 id="_1-xmlhttprequest缺点" tabindex="-1">1.XMLHttpRequest缺点 <a class="header-anchor" href="#_1-xmlhttprequest缺点" aria-label="Permalink to &quot;1.XMLHttpRequest缺点&quot;">​</a></h2><p>浏览器提供了原生的AJAX实现类XMLHttpRequest，基于该类实例，我们可以实现在网页上发送AJAX请求到服务端。</p><p>但是XMLHttpRequest的设计并不完美，主要体现在以下几个方面：</p><p>HTTP请求，响应都被耦合在XMLHttpRequest实例上，结构不够简单明了采用事件回调的方式获取HTTP响应，可能会产生回调地狱如果HTTP响应数据过大，则会占用大量内存最后一点就是，XMLHttpRequest实现AJAX的步骤太零碎了。</p><h2 id="_2-fetch-的优点" tabindex="-1">2.Fetch 的优点 <a class="header-anchor" href="#_2-fetch-的优点" aria-label="Permalink to &quot;2.Fetch 的优点&quot;">​</a></h2><p>fetch和XMLHttpRequest一样，也是浏览器原生的，用于发送AJAX请求。</p><p><img src="/assets/240428-bQJly4khPH.DA43A3ea.png" alt="fetch" loading="lazy"></p><p><img src="/assets/240428-xaXPRRdek7.BrFBBI5W.png" alt="image-20220624220655195" loading="lazy"></p><p>XMLHttpRequest之后诞生的，它旨在解决XMLHttpRequest的不足，所以XMLHttpRequest的缺点就是它的优点，具体优点如下</p><ul><li>语法简单，结构清晰明了</li><li>支持Promise获取异步的HTTP响应</li><li>HTTP响应支持流式获取，内存友好</li></ul><p>fetch被设计为函数，通过fetch函数调用即可发起AJAX，而不需要像XMLHttpRequest那样创建实例，然后基于xhr实例发起AJAX。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:3000/test&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// fetch函数调用即发起AJAX</span></span></code></pre></div><p>fetch函数返回一个Promise对象，而Promise对象的结果值就是HTTP响应</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:3000/test&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// fetch函数返回值是一个Promise类型对象</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 该Promise对象的结果值response就是HTTP响应</span></span></code></pre></div><p>fetch函数返回的Promise对象的结果值HTTP响应是流式获取，即使HTTP响应数据很大，也不会占用过多的内存。</p><h2 id="_3-fetch-基本用法" tabindex="-1">3.Fetch 基本用法 <a class="header-anchor" href="#_3-fetch-基本用法" aria-label="Permalink to &quot;3.Fetch 基本用法&quot;">​</a></h2><p><code>fetch()</code>的功能与 XMLHttpRequest 基本相同，但有三个主要的差异。</p><p>（1）<code>fetch()</code>使用 Promise，不使用回调函数，因此大大简化了写法，写起来更简洁。</p><p>（2）<code>fetch()</code>采用模块化设计，API 分散在多个对象上（Response 对象、Request 对象、Headers 对象），更合理一些；相比之下，XMLHttpRequest 的 API 设计并不是很好，输入、输出、状态都在同一个接口管理，容易写出非常混乱的代码。</p><p>（3）<code>fetch()</code>通过数据流（Stream 对象）处理数据，可以分块读取，有利于提高网站性能表现，减少内存占用，对于请求大文件或者网速慢的场景相当有用。XMLHTTPRequest 对象不支持数据流，所有的数据必须放在缓存里，不支持分块读取，必须等待全部拿到后，再一次性吐出来。</p><p>在用法上，<code>fetch()</code>接受一个 URL 字符串作为参数，默认向该网址发出 GET 请求，返回一个 Promise 对象。它的基本用法如下。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>下面是一个例子，从服务器获取 JSON 数据。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://api.github.com/users/ruanyf&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(json))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Request Failed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err));</span></span></code></pre></div><p>上面示例中，<code>fetch()</code>接收到的<code>response</code>是一个 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API" target="_blank" rel="noreferrer">Stream 对象</a>，<code>response.json()</code>是一个异步操作，取出所有内容，并将其转为 JSON 对象。</p><p>Promise 可以使用 await 语法改写，使得语义更清晰。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getJSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://api.github.com/users/ruanyf&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Request Failed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>上面示例中，<code>await</code>语句必须放在<code>try...catch</code>里面，这样才能捕捉异步操作中可能发生的错误。</p><p>后文都采用<code>await</code>的写法，不使用<code>.then()</code>的写法。</p><h2 id="_4-fetch-的请求对象" tabindex="-1">4.Fetch 的请求对象 <a class="header-anchor" href="#_4-fetch-的请求对象" aria-label="Permalink to &quot;4.Fetch 的请求对象&quot;">​</a></h2><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url,options).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//处理http响应</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//处理错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>url ：是发送网络请求的地址。</p><p>options：发送请求参数,</p><ul><li>body - http请求参数</li><li>mode - 请求的模式 <ul><li><code>cors</code>：默认值，允许跨域请求。</li><li><code>same-origin</code>：只允许同源请求。</li><li><code>no-cors</code>：请求方法只限于 GET、POST 和 HEAD，并且只能使用有限的几个简单标头，不能添加跨域的复杂标头，相当于提交表单所能发出的请求。</li></ul></li><li>cache - 用户指定缓存。</li><li>method - 请求方法，默认GET</li><li>signal - 用于取消 fetch</li><li>headers - http请求头设置</li><li>keepalive - 用于页面卸载时，告诉浏览器在后台保持连接，继续发送数据。</li><li>credentials -是否发送 Cookie <ul><li><code>same-origin</code>：默认值，同源请求时发送 Cookie，跨域请求时不发送。</li><li><code>include</code>：不管同源请求，还是跨域请求，一律发送 Cookie。</li><li><code>omit</code>：一律不发送。</li></ul></li><li>referrer- 用于设定<code>fetch()</code>请求的<code>referer</code>标头</li><li>referrerPolicy- 用于设定<code>Referer</code>标头的规则 <ul><li>no-referrer-when-downgrade：默认值，总是发送Referer标头，除非从 HTTPS 页面请求 HTTP 资源时不发送。</li><li>no-referrer：不发送Referer标头。</li><li>origin：Referer标头只包含域名，不包含完整的路径。</li><li>origin-when-cross-origin：同源请求Referer标头包含完整的路径，跨域请求只包含域名。</li><li>same-origin：跨域请求不发送Referer，同源请求发送。</li><li>strict-origin：Referer标头只包含域名，HTTPS 页面请求 HTTP 资源时不发送Referer标头。</li><li>strict-origin-when-cross-origin：同源请求时Referer标头包含完整路径，跨域请求时只包含域名，</li><li>HTTPS 页面请求 HTTP 资源时不发送该标头。</li><li>unsafe-url：不管什么情况，总是发送Referer标头。</li></ul></li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://localhost:3000/test&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application/json&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    body: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;qfc&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        age: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p><img src="https://i0.hdslb.com/bfs/album/fbd11a8129e218c75e9897080d3e4014f5db996a.png" alt="image-20220624222137163" loading="lazy"></p><p>其中需要注意的是Request对象的body属性，该属性值支持</p><ul><li>查询参数字符串，如&#39;name=qfc&amp;age=18&#39;</li><li>文本字符串，如&#39;{&quot;name&quot;:&quot;qfc&quot;, &quot;age&quot;: 18}&#39;</li><li>FormData对象</li><li>Blob对象</li><li>ReadableStream对象</li><li>BufferSource对象</li></ul><h2 id="_5-fetch-的响应对象" tabindex="-1">5.Fetch 的响应对象 <a class="header-anchor" href="#_5-fetch-的响应对象" aria-label="Permalink to &quot;5.Fetch 的响应对象&quot;">​</a></h2><h3 id="_5-1-response-对象的同步属性" tabindex="-1">5.1 Response 对象的同步属性 <a class="header-anchor" href="#_5-1-response-对象的同步属性" aria-label="Permalink to &quot;5.1 Response 对象的同步属性&quot;">​</a></h3><p><code>fetch()</code>请求成功以后，得到的是一个 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response" target="_blank" rel="noreferrer">Response 对象</a>。它对应服务器的 HTTP 回应。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url);</span></span></code></pre></div><p>前面说过，Response 包含的数据通过 Stream 接口异步读取，但是它还包含一些同步属性，对应 HTTP 回应的标头信息（Headers），可以立即读取。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/readme.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.status);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.statusText);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>上面示例中，<code>response.status</code>和<code>response.statusText</code>就是 Response 的同步属性，可以立即读取。</p><p>fetch 请求成功后，响应 response 对象如图：</p><p><img src="https://i0.hdslb.com/bfs/album/980304396e4a9765abf9f9831d4ab42a3870973d.png" alt="image-20220624221326446" loading="lazy"></p><p>标头信息属性有下面这些。</p><ul><li>status - <code>Response.status</code>属性返回一个数字，表示 HTTP 回应的状态码（例如200，表示成功请求）。</li><li>statusText - <code>Response.statusText</code>属性返回一个字符串，表示 HTTP 回应的状态信息（例如请求成功以后，服务器返回“OK”）。</li><li>ok - <code>Response.ok</code>属性返回一个布尔值，表示请求是否成功，<code>true</code>对应 HTTP 请求的状态码 200 到 299，<code>false</code>对应其他的状态码。</li><li>headers - 响应头</li><li>body - 响应体。响应体内的数据，根据类型各自处理。</li><li>type - 返回请求的类型。可能的值如下： <ul><li><code>basic</code>：普通请求，即同源请求。</li><li><code>cors</code>：跨源请求。</li><li><code>error</code>：网络错误，主要用于 Service Worker。</li><li><code>opaque</code>：如果<code>fetch()</code>请求的<code>type</code>属性设为<code>no-cors</code>，就会返回这个值，详见请求部分。表示发出的是简单的跨源请求，类似<code>&lt;form&gt;</code>表单的那种跨源请求。</li><li><code>opaqueredirect</code>：如果<code>fetch()</code>请求的<code>redirect</code>属性设为<code>manual</code>，就会返回这个值，详见请求部分。</li></ul></li><li>url - <code>Response.url</code>属性返回请求的 URL。如果 URL 存在跳转，该属性返回的是最终 URL。</li><li>redirected - 返回一个布尔值，表示请求是否发生过跳转。</li></ul><h3 id="_5-2-判断请求是否成功" tabindex="-1">5.2 判断请求是否成功 <a class="header-anchor" href="#_5-2-判断请求是否成功" aria-label="Permalink to &quot;5.2 判断请求是否成功&quot;">​</a></h3><p><code>fetch()</code>发出请求以后，有一个很重要的注意点：只有网络错误，或者无法连接时，<code>fetch()</code>才会报错，其他情况都不会报错，而是认为请求成功。</p><p>这就是说，即使服务器返回的状态码是 4xx 或 5xx，<code>fetch()</code>也不会报错（即 Promise 不会变为 <code>rejected</code>状态）。</p><p>只有通过<code>Response.status</code>属性，得到 HTTP 回应的真实状态码，才能判断请求是否成功。请看下面的例子。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/readme.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (response.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response.statusText);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>上面示例中，<code>response.status</code>属性只有等于 2xx （200~299），才能认定请求成功。这里不用考虑网址跳转（状态码为 3xx），因为<code>fetch()</code>会将跳转的状态码自动转为 200。</p><p>另一种方法是判断<code>response.ok</code>是否为<code>true</code>。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (response.ok) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 请求成功</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 请求失败</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_5-3-response-headers-属性" tabindex="-1">5.3 Response.headers 属性 <a class="header-anchor" href="#_5-3-response-headers-属性" aria-label="Permalink to &quot;5.3 Response.headers 属性&quot;">​</a></h3><p>Response 对象还有一个<code>Response.headers</code>属性，指向一个 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Headers" target="_blank" rel="noreferrer">Headers 对象</a>，对应 HTTP 回应的所有标头。</p><p>Headers 对象可以使用<code>for...of</code>循环进行遍历。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [key, value] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.headers) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} : ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 或者</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [key, value] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">entries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} : ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Headers 对象提供了以下方法，用来操作标头。</p><blockquote><ul><li><code>Headers.get()</code>：根据指定的键名，返回键值。</li><li><code>Headers.has()</code>： 返回一个布尔值，表示是否包含某个标头。</li><li><code>Headers.set()</code>：将指定的键名设置为新的键值，如果该键名不存在则会添加。</li><li><code>Headers.append()</code>：添加标头。</li><li><code>Headers.delete()</code>：删除标头。</li><li><code>Headers.keys()</code>：返回一个遍历器，可以依次遍历所有键名。</li><li><code>Headers.values()</code>：返回一个遍历器，可以依次遍历所有键值。</li><li><code>Headers.entries()</code>：返回一个遍历器，可以依次遍历所有键值对（<code>[key, value]</code>）。</li><li><code>Headers.forEach()</code>：依次遍历标头，每个标头都会执行一次参数函数。</li></ul></blockquote><p>上面的有些方法可以修改标头，那是因为继承自 Headers 接口。对于 HTTP 回应来说，修改标头意义不大，况且很多标头是只读的，浏览器不允许修改。</p><p>这些方法中，最常用的是<code>response.headers.get()</code>，用于读取某个标头的值。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response.headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// application/json; charset=utf-8</span></span></code></pre></div><p><code>Headers.keys()</code>和<code>Headers.values()</code>方法用来分别遍历标头的键名和键值。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 键名</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myHeaders.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">keys</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 键值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myHeaders.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(value);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>Headers.forEach()</code>方法也可以遍历所有的键值和键名。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response.headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="_5-4-读取内容的方法" tabindex="-1">5.4 读取内容的方法 <a class="header-anchor" href="#_5-4-读取内容的方法" aria-label="Permalink to &quot;5.4 读取内容的方法&quot;">​</a></h3><p><code>Response</code>对象根据服务器返回的不同类型的数据，提供了不同的读取方法。</p><blockquote><ul><li><code>response.text()</code>：得到文本字符串。</li><li><code>response.json()</code>：得到 JSON 对象。</li><li><code>response.blob()</code>：得到二进制 Blob 对象。</li><li><code>response.formData()</code>：得到 FormData 表单对象。</li><li><code>response.arrayBuffer()</code>：得到二进制 ArrayBuffer 对象。</li></ul></blockquote><p>上面5个读取方法都是异步的，返回的都是 Promise 对象。必须等到异步操作结束，才能得到服务器返回的完整数据。</p><p><strong>response.text()</strong></p><p><code>response.text()</code>可以用于获取文本数据，比如 HTML 文件。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>const response = await fetch(&#39;/users.html&#39;);</span></span>
<span class="line"><span>const body = await response.text();</span></span>
<span class="line"><span>document.body.innerHTML = body</span></span></code></pre></div><p><strong>response.json()</strong></p><p><code>response.json()</code>主要用于获取服务器返回的 JSON 数据，前面已经举过例子了。</p><p><strong>response.formData()</strong></p><p><code>response.formData()</code>主要用在 Service Worker 里面，拦截用户提交的表单，修改某些数据以后，再提交给服务器。</p><p><strong>response.blob()</strong></p><p><code>response.blob()</code>用于获取二进制文件。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>const response = await fetch(&#39;flower.jpg&#39;);</span></span>
<span class="line"><span>const myBlob = await response.blob();</span></span>
<span class="line"><span>const objectURL = URL.createObjectURL(myBlob);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const myImage = document.querySelector(&#39;img&#39;);</span></span>
<span class="line"><span>myImage.src = objectURL;</span></span></code></pre></div><p>上面示例读取图片文件<code>flower.jpg</code>，显示在网页上。</p><p><strong>response.arrayBuffer()</strong></p><p><code>response.arrayBuffer()</code>主要用于获取流媒体文件。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>const audioCtx = new window.AudioContext();</span></span>
<span class="line"><span>const source = audioCtx.createBufferSource();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const response = await fetch(&#39;song.ogg&#39;);</span></span>
<span class="line"><span>const buffer = await response.arrayBuffer();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const decodeData = await audioCtx.decodeAudioData(buffer);</span></span>
<span class="line"><span>source.buffer = buffer;</span></span>
<span class="line"><span>source.connect(audioCtx.destination);</span></span>
<span class="line"><span>source.loop = true;</span></span></code></pre></div><p>上面示例是<code>response.arrayBuffer()</code>获取音频文件<code>song.ogg</code>，然后在线播放的例子。</p><h3 id="_5-5-response-clone" tabindex="-1">5.5 Response.clone() <a class="header-anchor" href="#_5-5-response-clone" aria-label="Permalink to &quot;5.5 Response.clone()&quot;">​</a></h3><p>Stream 对象只能读取一次，读取完就没了。这意味着，前一节的五个读取方法，只能使用一个，否则会报错。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 报错</span></span></code></pre></div><p>上面示例先使用了<code>response.text()</code>，就把 Stream 读完了。后面再调用<code>response.json()</code>，就没有内容可读了，所以报错。</p><p>Response 对象提供<code>Response.clone()</code>方法，创建<code>Response</code>对象的副本，实现多次读取。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;flowers.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> myBlob1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> myBlob2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response2.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image1.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myBlob1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image2.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myBlob2);</span></span></code></pre></div><p>上面示例中，<code>response.clone()</code>复制了一份 Response 对象，然后将同一张图片读取了两次。</p><p>Response 对象还有一个<code>Response.redirect()</code>方法，用于将 Response 结果重定向到指定的 URL。该方法一般只用在 Service Worker 里面，这里就不介绍了。</p><h3 id="_5-6-response-body-属性" tabindex="-1">5.6 Response.body 属性 <a class="header-anchor" href="#_5-6-response-body-属性" aria-label="Permalink to &quot;5.6 Response.body 属性&quot;">​</a></h3><p><code>Response.body</code>属性是 Response 对象暴露出的底层接口，返回一个 ReadableStream 对象，供用户操作。</p><p>它可以用来分块读取内容，应用之一就是显示下载的进度。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;flower.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.body.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getReader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">done</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (done) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`Received ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} bytes`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>上面示例中，<code>response.body.getReader()</code>方法返回一个遍历器。这个遍历器的<code>read()</code>方法每次返回一个对象，表示本次读取的内容块。</p><p>这个对象的<code>done</code>属性是一个布尔值，用来判断有没有读完；<code>value</code>属性是一个 arrayBuffer 数组，表示内容块的内容，而<code>value.length</code>属性是当前块的大小。</p><h2 id="_6-fetch-的第二个参数-定制-http-请求" tabindex="-1">6.<code>fetch()</code>的第二个参数：定制 HTTP 请求 <a class="header-anchor" href="#_6-fetch-的第二个参数-定制-http-请求" aria-label="Permalink to &quot;6.`fetch()`的第二个参数：定制 HTTP 请求&quot;">​</a></h2><p><code>fetch()</code>的第一个参数是 URL，还可以接受第二个参数，作为配置对象，定制发出的 HTTP 请求。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, optionObj)</span></span></code></pre></div><p>上面命令的<code>optionObj</code>就是第二个参数。</p><p>HTTP 请求的方法、标头、数据体都在这个对象里面设置。下面是一些示例。</p><p><strong>（1）POST 请求</strong></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  headers: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;Content-type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  body: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;foo=bar&amp;lorem=ipsum&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p>上面示例中，配置对象用到了三个属性。</p><blockquote><ul><li><code>method</code>：HTTP 请求的方法，<code>POST</code>、<code>DELETE</code>、<code>PUT</code>都在这个属性设置。</li><li><code>headers</code>：一个对象，用来定制 HTTP 请求的标头。</li><li><code>body</code>：POST 请求的数据体。</li></ul></blockquote><p>注意，有些标头不能通过<code>headers</code>属性设置，比如<code>Content-Length</code>、<code>Cookie</code>、<code>Host</code>等等。它们是由浏览器自动生成，无法修改。</p><p><strong>（2）提交 JSON 数据</strong></p><p>如果是提交json数据时，需要把json转换成字符串。如</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`http://localhost:80/fetch`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> method:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application/json;charset=utf-8&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    body: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;qfc&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        age: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;响应&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,response)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p><strong>（3）提交表单</strong></p><p>如果提交的是表单数据，使用 formData转化下，如：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FormData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(form)</span></span></code></pre></div><p>上传文件，可以包含在整个表单里一起提交，如：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> input</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">querySelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;input[type=&quot;file&quot;]&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FormData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;file&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, input.files[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;foo&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/avatars&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  body: data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p><strong>（4）文件上传</strong></p><p>如果表单里面有文件选择器，可以用前一个例子的写法，上传的文件包含在整个表单里面，一起提交。</p><p>另一种方法是用脚本添加文件，构造出一个表单，进行上传，请看下面的例子。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> input</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">querySelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;input[type=&quot;file&quot;]&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FormData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;file&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, input.files[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;foo&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/avatars&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  body: data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>上传二进制文件时，不用修改标头的<code>Content-Type</code>，浏览器会自动设置。</p><p><strong>（5）直接上传二进制数据</strong></p><p><code>fetch()</code>也可以直接上传二进制数据，将 Blob 或 arrayBuffer 数据放在<code>body</code>属性里面。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blob </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  canvasElem.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resolve,  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;image/png&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/article/fetch/post/image&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  method:  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  body: blob</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="_7-fetch-配置对象的完整-api" tabindex="-1">7.<code>fetch()</code>配置对象的完整 API <a class="header-anchor" href="#_7-fetch-配置对象的完整-api" aria-label="Permalink to &quot;7.`fetch()`配置对象的完整 API&quot;">​</a></h2><p><code>fetch()</code>第二个参数的完整 API 如下。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  headers: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text/plain;charset=UTF-8&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  body: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  referrer: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;about:client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  referrerPolicy: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;no-referrer-when-downgrade&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  mode: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  credentials: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;same-origin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cache: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;default&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  redirect: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;follow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  integrity: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  keepalive: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  signal: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">undefined</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p><code>fetch()</code>请求的底层用的是 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/Request" target="_blank" rel="noreferrer">Request() 对象</a>的接口，参数完全一样，因此上面的 API 也是<code>Request()</code>的 API。</p><p>这些属性里面，<code>headers</code>、<code>body</code>、<code>method</code>前面已经给过示例了，下面是其他属性的介绍。</p><p><strong>cache</strong></p><p><code>cache</code>属性指定如何处理缓存。可能的取值如下：</p><ul><li><code>default</code>：默认值，先在缓存里面寻找匹配的请求。</li><li><code>no-store</code>：直接请求远程服务器，并且不更新缓存。</li><li><code>reload</code>：直接请求远程服务器，并且更新缓存。</li><li><code>no-cache</code>：将服务器资源跟本地缓存进行比较，有新的版本才使用服务器资源，否则使用缓存。</li><li><code>force-cache</code>：缓存优先，只有不存在缓存的情况下，才请求远程服务器。</li><li><code>only-if-cached</code>：只检查缓存，如果缓存里面不存在，将返回504错误。</li></ul><p><strong>mode</strong></p><p><code>mode</code>属性指定请求的模式。可能的取值如下：</p><ul><li><code>cors</code>：默认值，允许跨源请求。</li><li><code>same-origin</code>：只允许同源请求。</li><li><code>no-cors</code>：请求方法只限于 GET、POST 和 HEAD，并且只能使用有限的几个简单标头，不能添加跨源的复杂标头，相当于提交表单、<code>&lt;script&gt;</code>加载脚本、<code>&lt;img&gt;</code>加载图片等传统的跨源请求方法。</li></ul><p><strong>credentials</strong></p><p><code>credentials</code>属性指定是否发送 Cookie。可能的取值如下：</p><ul><li><code>same-origin</code>：默认值，同源请求时发送 Cookie，跨源请求时不发送。</li><li><code>include</code>：不管同源请求，还是跨源请求，一律发送 Cookie。</li><li><code>omit</code>：一律不发送。</li></ul><p>跨源请求发送 Cookie，需要将<code>credentials</code>属性设为<code>include</code>。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://another.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  credentials: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;include&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p><strong>signal</strong></p><p><code>signal</code>属性指定一个 AbortSignal 实例，用于取消<code>fetch()</code>请求，详见下一节。</p><p><strong>keepalive</strong></p><p><code>keepalive</code>属性用于页面卸载时，告诉浏览器在后台保持连接，继续发送数据。</p><p>一个典型的场景就是，用户离开网页时，脚本向服务器提交一些用户行为的统计信息。这时，如果不用<code>keepalive</code>属性，数据可能无法发送，因为浏览器已经把页面卸载了。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onunload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/analytics&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application/json&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    body: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      some: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;data&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    keepalive: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p><strong>redirect</strong></p><p><code>redirect</code>属性指定 HTTP 跳转的处理方法。可能的取值如下：</p><ul><li><code>follow</code>：默认值，<code>fetch()</code>跟随 HTTP 跳转。</li><li><code>error</code>：如果发生跳转，<code>fetch()</code>就报错。</li><li><code>manual</code>：<code>fetch()</code>不跟随 HTTP 跳转，但是<code>response.url</code>属性会指向新的 URL，<code>response.redirected</code>属性会变为<code>true</code>，由开发者自己决定后续如何处理跳转。</li></ul><p><strong>integrity</strong></p><p><code>integrity</code>属性指定一个哈希值，用于检查 HTTP 回应传回的数据是否等于这个预先设定的哈希值。</p><p>比如，下载文件时，检查文件的 SHA-256 哈希值是否相符，确保没有被篡改。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://site.com/file&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  integrity: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sha256-abcdef&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p><strong>referrer</strong></p><p><code>referrer</code>属性用于设定<code>fetch()</code>请求的<code>referer</code>标头。</p><p>这个属性可以为任意字符串，也可以设为空字符串（即不发送<code>referer</code>标头）。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/page&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  referrer: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p><strong>referrerPolicy</strong></p><p><code>referrerPolicy</code>属性用于设定<code>Referer</code>标头的规则。可能的取值如下：</p><ul><li><code>no-referrer-when-downgrade</code>：默认值，总是发送<code>Referer</code>标头，除非从 HTTPS 页面请求 HTTP 资源时不发送。</li><li><code>no-referrer</code>：不发送<code>Referer</code>标头。</li><li><code>origin</code>：<code>Referer</code>标头只包含域名，不包含完整的路径。</li><li><code>origin-when-cross-origin</code>：同源请求<code>Referer</code>标头包含完整的路径，跨源请求只包含域名。</li><li><code>same-origin</code>：跨源请求不发送<code>Referer</code>，同源请求发送。</li><li><code>strict-origin</code>：<code>Referer</code>标头只包含域名，HTTPS 页面请求 HTTP 资源时不发送<code>Referer</code>标头。</li><li><code>strict-origin-when-cross-origin</code>：同源请求时<code>Referer</code>标头包含完整路径，跨源请求时只包含域名，HTTPS 页面请求 HTTP 资源时不发送该标头。</li><li><code>unsafe-url</code>：不管什么情况，总是发送<code>Referer</code>标头。</li></ul><h2 id="_8-取消fetch-请求" tabindex="-1">8.取消<code>fetch()</code>请求 <a class="header-anchor" href="#_8-取消fetch-请求" aria-label="Permalink to &quot;8.取消`fetch()`请求&quot;">​</a></h2><p><code>fetch()</code>请求发送以后，如果中途想要取消，需要使用<code>AbortController</code>对象。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> controller </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> signal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> controller.signal;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  signal: controller.signal</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">signal.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;abort&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;abort!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 取消</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(signal.aborted); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// true</span></span></code></pre></div><p>上面示例中，首先新建 AbortController 实例，然后发送<code>fetch()</code>请求，配置对象的<code>signal</code>属性必须指定接收 AbortController 实例发送的信号<code>controller.signal</code>。</p><p><code>controller.abort()</code>方法用于发出取消信号。这时会触发<code>abort</code>事件，这个事件可以监听，也可以通过<code>controller.signal.aborted</code>属性判断取消信号是否已经发出。</p><p>下面是一个1秒后自动取消请求的例子。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> controller </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/long-operation&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    signal: controller.signal</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;AbortError&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Aborted!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-2295edbf data-v-fbb4769a><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-fbb4769a><span class="visually-hidden" id="doc-footer-aria-label" data-v-fbb4769a>Pager</span><div class="pager" data-v-fbb4769a><a class="VPLink link pager-link prev" href="/ajax/2.html" data-v-fbb4769a><!--[--><span class="desc" data-v-fbb4769a>Previous page</span><span class="title" data-v-fbb4769a>02【Axios】</span><!--]--></a></div><div class="pager" data-v-fbb4769a><a class="VPLink link pager-link next" href="/ajax/4.html" data-v-fbb4769a><!--[--><span class="desc" data-v-fbb4769a>Next page</span><span class="title" data-v-fbb4769a>04 【跨域初识】</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-2fdd469f data-v-991ed27d><div class="container" data-v-991ed27d><!----><p class="copyright" data-v-991ed27d>Copyright © 2024-present <a href="mailto:xuzn@msn.com">xuzn@msn.com</a></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"ajax_4.md\":\"CnI-hXyq\",\"ajax_2.md\":\"B5aHVomh\",\"browser_2.md\":\"O3n8AWyk\",\"html_5.md\":\"BjFnemWh\",\"javascript_12.md\":\"B04cKqE-\",\"browser_3.md\":\"CAvZOYk9\",\"javascript_16.md\":\"BV_TghHR\",\"en_index.md\":\"CqF6MrFb\",\"browser_1.md\":\"UohTcmaa\",\"css_10.md\":\"D68w-0cj\",\"html_10.md\":\"BD7XuaJg\",\"javascript_23.md\":\"kKYufPJd\",\"css_1.md\":\"kk4ehwgg\",\"javascript_19.md\":\"BVq-Pzfd\",\"javascript_25.md\":\"uhRIxA2d\",\"network security_1.md\":\"CBMAWmUT\",\"html_8.md\":\"CFjlzN5q\",\"html_2.md\":\"DLWsFhi1\",\"git_4.md\":\"Dgkwp4qk\",\"ajax_3.md\":\"BVB_7yCr\",\"network security_8.md\":\"BwNFi1lP\",\"javascript_21.md\":\"J888DKwj\",\"javascript_13.md\":\"VD3nNV4d\",\"javascript_27.md\":\"MolSrIu2\",\"vue3_4.md\":\"B_MOM3ms\",\"css_7.md\":\"CzTkAG62\",\"javascript_15.md\":\"DfL5MutI\",\"ajax_1.md\":\"DMEHmWrZ\",\"javascript_18.md\":\"CI_LridG\",\"javascript_1.md\":\"CUHG5f0X\",\"javascript_30.md\":\"BfrGNFyJ\",\"security devices_1.md\":\"DTL81A7N\",\"kali_1.md\":\"DIIdRcML\",\"javascript_8.md\":\"CRHL2m9D\",\"html_3.md\":\"BW9ZYc19\",\"css_8.md\":\"CYfNNwok\",\"css_5.md\":\"BMBqAxiQ\",\"markdown-examples.md\":\"xS3QsCqk\",\"git_2.md\":\"BNxRtHhL\",\"python_10.md\":\"CjOj-dQ3\",\"security devices_8.md\":\"gDCdBHwk\",\"git_1.md\":\"kiVxQaQc\",\"python_1.md\":\"DazJJh9Z\",\"linux_9.md\":\"B5hnvWq8\",\"network security_12.md\":\"BnuR9i5I\",\"less and scss_2.md\":\"2YIhgHSy\",\"html_7.md\":\"BquEYTW6\",\"html_6.md\":\"mzqBEiet\",\"css_6.md\":\"Dj2NJtQJ\",\"javascript_11.md\":\"Bj15Xs8O\",\"less and scss_1.md\":\"CxLlqX08\",\"html_9.md\":\"Qtc4rwAS\",\"typescript_8.md\":\"owjztxlz\",\"javascript_17.md\":\"CXjGc8st\",\"css_9.md\":\"DGzby0Ry\",\"nodejs_10.md\":\"BiZNlyC1\",\"javascript_9.md\":\"DvtC7GbI\",\"security devices_7.md\":\"BeMHMjgz\",\"security devices_2.md\":\"dJDeeUjI\",\"javascript_2.md\":\"DKWSR38O\",\"nodejs_11.md\":\"C5AL6QBm\",\"linux_4.md\":\"BtsTU7iC\",\"linux_7.md\":\"B_romsTW\",\"python_11.md\":\"6LRqJmWv\",\"css_3.md\":\"BK1d7wCs\",\"javascript_26.md\":\"CJs1wtMM\",\"typescript_6.md\":\"BMuzEGpB\",\"css_4.md\":\"B8P16ndm\",\"network security_5.md\":\"C9MBoQqS\",\"kali_2.md\":\"BBa2tdsn\",\"network security_9.md\":\"vBAxg3L1\",\"git_3.md\":\"BCyXunGW\",\"linux_10.md\":\"Chu6r5EM\",\"typescript_4.md\":\"rMK8bcbJ\",\"javascript_5.md\":\"BcNEeyL0\",\"kali_5.md\":\"gKYM4k-A\",\"security devices_9.md\":\"eN5obYrg\",\"typescript_9.md\":\"DLdJ-gZT\",\"linux_1.md\":\"C793L66_\",\"javascript_22.md\":\"BiAMcJ-U\",\"security devices_3.md\":\"fYMhj3CP\",\"kali_3.md\":\"CkJ2SJ55\",\"html_1.md\":\"D5ZxMayW\",\"python_8.md\":\"CWAUmu9d\",\"typescript_10.md\":\"Cv0ezhMX\",\"index.md\":\"gUiJkRhN\",\"javascript_3.md\":\"DhCLKCIv\",\"javascript_32.md\":\"BQdXvtsK\",\"security devices_4.md\":\"BAXO_DuJ\",\"javascript_29.md\":\"BMOEy__t\",\"javascript_34.md\":\"rPeTLtUj\",\"network security_10.md\":\"IAwv8XvL\",\"api-examples.md\":\"09Grijv8\",\"network security_7.md\":\"CLSO0_yv\",\"javascript_33.md\":\"7aM3LbR-\",\"nodejs_5.md\":\"DnRTJSPL\",\"typescript_3.md\":\"7yZLR1gX\",\"security devices_6.md\":\"B2yWS3Xc\",\"kali_4.md\":\"CHbb2U88\",\"javascript_10.md\":\"CLyAVJsZ\",\"nodejs_7.md\":\"CPnfuOiz\",\"vue3_2.md\":\"CAb8JAT1\",\"linux_6.md\":\"HjzmY8qL\",\"javascript_6.md\":\"CEbnzZbz\",\"nodejs_6.md\":\"CbexqIeJ\",\"javascript_4.md\":\"CZ51kLkD\",\"network security_6.md\":\"dqq2NkaQ\",\"javascript_7.md\":\"CXr91vVy\",\"security devices_5.md\":\"CZ8d1NST\",\"nodejs_1.md\":\"CJJ5SCO7\",\"vue3_6.md\":\"_CT91LjT\",\"network security_11.md\":\"DE0Aq-yS\",\"python_7.md\":\"RmRfRO64\",\"python_3.md\":\"N0YJ0Ki4\",\"javascript_24.md\":\"D8q-qQsX\",\"python_2.md\":\"BZDifyyZ\",\"network security_4.md\":\"BOc-hIQr\",\"linux_5.md\":\"BFLrWW7O\",\"javascript_28.md\":\"D_vV-d1H\",\"javascript_31.md\":\"BC7VOY6R\",\"linux_2.md\":\"DkVWgeAV\",\"css_2.md\":\"4INzyWAS\",\"javascript_14.md\":\"4YerQ04A\",\"vue3_7.md\":\"DHQz61rT\",\"python_6.md\":\"CNosXNf5\",\"python_9.md\":\"ByQXBSIx\",\"en.md\":\"BeVNFkzr\",\"typescript_1.md\":\"CrkGpsMg\",\"network security_3.md\":\"BDmJq9HK\",\"nodejs_9.md\":\"Bf_M6YOr\",\"vue3_8.md\":\"CmfhTJdA\",\"python_5.md\":\"CeI2035Z\",\"vue3_3.md\":\"BPljwkWu\",\"javascript_20.md\":\"CnI708tY\",\"vue3_1.md\":\"BFiqfg6t\",\"linux_3.md\":\"B7NzcTfP\",\"network security_2.md\":\"C0KQcFIQ\",\"linux_8.md\":\"CGF4Z_8U\",\"vue3_5.md\":\"Cr70K63Z\",\"typescript_5.md\":\"7s_PHXbK\",\"typescript_2.md\":\"B4g6eVNg\",\"nodejs_3.md\":\"B_oghSF9\",\"nodejs_4.md\":\"Dvc5vDE0\",\"nodejs_2.md\":\"DQJI3-xm\",\"html_4.md\":\"CgHeUZFs\",\"nodejs_8.md\":\"B0BnDGA1\",\"python_4.md\":\"D8Oy6f4X\",\"typescript_7.md\":\"nRpvJPCc\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"yage\",\"description\":\"yage Blog\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":\"dark\",\"themeConfig\":{\"logo\":\"/stars.png\",\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"前端\",\"items\":[{\"text\":\"HTML\",\"link\":\"/html/1\"},{\"text\":\"CSS\",\"link\":\"/css/1\"},{\"text\":\"JavaScript\",\"link\":\"/javascript/1\"},{\"text\":\"ajax\",\"link\":\"/ajax/1\"},{\"text\":\"less and scss\",\"link\":\"/less and scss/1\"},{\"text\":\"TypeScript\",\"link\":\"/typescript/1\"},{\"text\":\"Vue3\",\"link\":\"/vue3/1\"},{\"text\":\"浏览器工作原理\",\"link\":\"/browser/1\"}]},{\"text\":\"安全\",\"items\":[{\"text\":\"Kali\",\"link\":\"/kali/1\"},{\"text\":\"网络安全\",\"link\":\"/network security/1\"},{\"text\":\"安全设备\",\"link\":\"/security devices/1\"}]},{\"text\":\"Python\",\"link\":\"/python/1\"},{\"text\":\"Nodejs\",\"link\":\"/nodejs/1\"},{\"text\":\"Git\",\"link\":\"/git/1\"},{\"text\":\"Linux\",\"link\":\"/linux/1\"}],\"sidebar\":{\"/python/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"Python环境搭建与输入输出\",\"link\":\"/python/1\"},{\"text\":\"Python运算符与if结构\",\"link\":\"/python/2\"},{\"text\":\"Python中的循环结构\",\"link\":\"/python/3\"},{\"text\":\"Python数据序列(一)\",\"link\":\"/python/4\"},{\"text\":\"Python数据序列(二)\",\"link\":\"/python/5\"},{\"text\":\"Python中的函数\",\"link\":\"/python/6\"},{\"text\":\"Python函数进阶\",\"link\":\"/python/7\"},{\"text\":\"Python文件操作\",\"link\":\"/python/8\"},{\"text\":\"Python面向对象\",\"link\":\"/python/9\"},{\"text\":\"Python的异常、模块以及包管理\",\"link\":\"/python/10\"},{\"text\":\"Python线程进程和协程\",\"link\":\"/python/11\"}]}],\"/nodejs/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"一、Node.js基础\",\"link\":\"/nodejs/1\"},{\"text\":\"二、Express\",\"link\":\"/nodejs/2\"},{\"text\":\"三、MongoDB\",\"link\":\"/nodejs/3\"},{\"text\":\"四、接口规范与业务分层\",\"link\":\"/nodejs/4\"},{\"text\":\"五、登录鉴权\",\"link\":\"/nodejs/5\"},{\"text\":\"六、文件上传管理\",\"link\":\"/nodejs/6\"},{\"text\":\"七、APIDOC - API 文档生成工具\",\"link\":\"/nodejs/7\"},{\"text\":\"八、Koa2\",\"link\":\"/nodejs/8\"},{\"text\":\"九、MySQL\",\"link\":\"/nodejs/9\"},{\"text\":\"十、Socket编程\",\"link\":\"/nodejs/10\"},{\"text\":\"十一、mocha\",\"link\":\"/nodejs/11\"}]}],\"/html/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"一、前序知识\",\"link\":\"/html/1\"},{\"text\":\"二、HTML 简介\",\"link\":\"/html/2\"},{\"text\":\"三、HTML 入门\",\"link\":\"/html/3\"},{\"text\":\"四、HTML 基础\",\"link\":\"/html/4\"},{\"text\":\"五、HTML5简介\",\"link\":\"/html/5\"},{\"text\":\"六、新增语义化标签\",\"link\":\"/html/6\"},{\"text\":\"七、新增表单功能\",\"link\":\"/html/7\"},{\"text\":\"八、新增多媒体标签\",\"link\":\"/html/8\"},{\"text\":\"九、新增全局属性（了解）\",\"link\":\"/html/9\"},{\"text\":\"十、HTML5兼容性处理\",\"link\":\"/html/10\"}]}],\"/css/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"一、CSS基础\",\"link\":\"/css/1\"},{\"text\":\"二、CSS选择器\",\"link\":\"/css/2\"},{\"text\":\"三、CSS三大特性\",\"link\":\"/css/3\"},{\"text\":\"四、CSS常用属性\",\"link\":\"/css/4\"},{\"text\":\"五、CSS盒子模型\",\"link\":\"/css/5\"},{\"text\":\"六、浮动\",\"link\":\"/css/6\"},{\"text\":\"七、定位\",\"link\":\"/css/7\"},{\"text\":\"八、布局\",\"link\":\"/css/8\"},{\"text\":\"九、CSS3 简介\",\"link\":\"/css/9\"},{\"text\":\"十、CSS3 基本语法\",\"link\":\"/css/10\"}]}],\"/javascript/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"-----【JavaScript 基础】-----\",\"link\":\"/javascript/1\"},{\"text\":\"介绍\",\"link\":\"/javascript/2\"},{\"text\":\"变量和常亮\",\"link\":\"/javascript/3\"},{\"text\":\"数据类型\",\"link\":\"/javascript/4\"},{\"text\":\"类型转换\",\"link\":\"/javascript/5\"},{\"text\":\"运算符\",\"link\":\"/javascript/6\"},{\"text\":\"语句\",\"link\":\"/javascript/7\"},{\"text\":\"for 语句\",\"link\":\"/javascript/8\"},{\"text\":\"数组\",\"link\":\"/javascript/9\"},{\"text\":\"函数\",\"link\":\"/javascript/10\"},{\"text\":\"-----【Web APIs】-----\",\"link\":\"/javascript/11\"},{\"text\":\"介绍\",\"link\":\"/javascript/12\"},{\"text\":\"DOM基本操作\",\"link\":\"/javascript/13\"},{\"text\":\"DOM注册事件\",\"link\":\"/javascript/14\"},{\"text\":\"事件进阶\",\"link\":\"/javascript/15\"},{\"text\":\"DOM进阶\",\"link\":\"/javascript/16\"},{\"text\":\"BOM操作\",\"link\":\"/javascript/17\"},{\"text\":\"正则表达式\",\"link\":\"/javascript/18\"},{\"text\":\"-----【JavaScript 进阶】-----\",\"link\":\"/javascript/19\"},{\"text\":\"作用域\",\"link\":\"/javascript/20\"},{\"text\":\"函数\",\"link\":\"/javascript/21\"},{\"text\":\"解构赋值\",\"link\":\"/javascript/22\"},{\"text\":\"综合案例\",\"link\":\"/javascript/23\"},{\"text\":\"深入对象\",\"link\":\"/javascript/24\"},{\"text\":\"内置构造函数\",\"link\":\"/javascript/25\"},{\"text\":\"属性描述符\",\"link\":\"/javascript/26\"},{\"text\":\"编程思想\",\"link\":\"/javascript/27\"},{\"text\":\"类\",\"link\":\"/javascript/28\"},{\"text\":\"原型对象\",\"link\":\"/javascript/29\"},{\"text\":\"面向对象综合案例\",\"link\":\"/javascript/30\"},{\"text\":\"深浅拷贝\",\"link\":\"/javascript/31\"},{\"text\":\"异常处理\",\"link\":\"/javascript/32\"},{\"text\":\"处理this\",\"link\":\"/javascript/33\"},{\"text\":\"防抖节流\",\"link\":\"/javascript/34\"}]}],\"/git/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"1、预前配置\",\"link\":\"/git/1\"},{\"text\":\"2、基本命令\",\"link\":\"/git/2\"},{\"text\":\"3、Git远程仓库\",\"link\":\"/git/3\"},{\"text\":\"4、快速推送\",\"link\":\"/git/4\"}]}],\"/linux/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"远程连接\",\"link\":\"/linux/1\"},{\"text\":\"vim编辑器\",\"link\":\"/linux/2\"},{\"text\":\"重定向/环境变量\",\"link\":\"/linux/3\"},{\"text\":\"Linux命令\",\"link\":\"/linux/4\"},{\"text\":\"用户和权限\",\"link\":\"/linux/5\"},{\"text\":\"存储和硬盘\",\"link\":\"/linux/6\"},{\"text\":\"RAID和LVM\",\"link\":\"/linux/7\"},{\"text\":\"Shell编程\",\"link\":\"/linux/8\"},{\"text\":\"进阶玩法\",\"link\":\"/linux/9\"},{\"text\":\"问题篇\",\"link\":\"/linux/10\"}]}],\"/ajax/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"01 【AJAX】\",\"link\":\"/ajax/1\"},{\"text\":\"02【Axios】\",\"link\":\"/ajax/2\"},{\"text\":\"03 【Fetch】\",\"link\":\"/ajax/3\"},{\"text\":\"04 【跨域初识】\",\"link\":\"/ajax/4\"}]}],\"/less and scss/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"LESS\",\"link\":\"/less and scss/1\"},{\"text\":\"SASS\",\"link\":\"/less and scss/2\"}]}],\"/browser/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"事件循环\",\"link\":\"/browser/1\"},{\"text\":\"渲染原理\",\"link\":\"/browser/2\"},{\"text\":\"CSS 属性计算过程\",\"link\":\"/browser/3\"}]}],\"/vue3/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"1. Vue3简介\",\"link\":\"/vue3/1\"},{\"text\":\"2. 创建Vue3工程\",\"link\":\"/vue3/2\"},{\"text\":\"3. Vue3核心语法\",\"link\":\"/vue3/3\"},{\"text\":\"4. 路由\",\"link\":\"/vue3/4\"},{\"text\":\"5. pinia \",\"link\":\"/vue3/5\"},{\"text\":\"6. 组件通信\",\"link\":\"/vue3/6\"},{\"text\":\"7. 其它 API\",\"link\":\"/vue3/7\"},{\"text\":\"8. Vue3新组件\",\"link\":\"/vue3/8\"}]}],\"/typescript/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"环境配置\",\"link\":\"/typescript/1\"},{\"text\":\"基础类型\",\"link\":\"/typescript/2\"},{\"text\":\"配置与调试\",\"link\":\"/typescript/3\"},{\"text\":\"断言使用\",\"link\":\"/typescript/4\"},{\"text\":\"类与接口\",\"link\":\"/typescript/5\"},{\"text\":\"泛型 Generics\",\"link\":\"/typescript/6\"},{\"text\":\"装饰器\",\"link\":\"/typescript/7\"},{\"text\":\"模块管理\",\"link\":\"/typescript/8\"},{\"text\":\"webpack\",\"link\":\"/typescript/9\"},{\"text\":\"类型工具\",\"link\":\"/typescript/10\"}]}],\"/network security/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"一、dos基本命令\",\"link\":\"/network security/1\"},{\"text\":\"二、用户与组管理\",\"link\":\"/network security/2\"},{\"text\":\"三、服务器的远程管理\",\"link\":\"/network security/3\"},{\"text\":\"四、破解windows系统密码\",\"link\":\"/network security/4\"},{\"text\":\"五、NTFS安全权限\",\"link\":\"/network security/5\"},{\"text\":\"六、文件共享服务器\",\"link\":\"/network security/6\"},{\"text\":\"七、DHCP部署与安全\",\"link\":\"/network security/7\"},{\"text\":\"八、DNS部署与安全\",\"link\":\"/network security/8\"},{\"text\":\"九、WEB服务器和FTP服务器\",\"link\":\"/network security/9\"},{\"text\":\"十、域\",\"link\":\"/network security/10\"},{\"text\":\"十一、PKI\",\"link\":\"/network security/11\"},{\"text\":\"十二、扫描与爆破\",\"link\":\"/network security/12\"}]}],\"/kali/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"一、被动信息收集\",\"link\":\"/kali/1\"},{\"text\":\"二、主动信息收集\",\"link\":\"/kali/2\"},{\"text\":\"三、WireShark抓包及常用协议分析\",\"link\":\"/kali/3\"},{\"text\":\"四、NMAP高级使用技巧和漏洞扫描发现\",\"link\":\"/kali/4\"},{\"text\":\"五、漏洞利用\",\"link\":\"/kali/5\"}]}],\"/security devices/\":[{\"text\":\"目录\",\"items\":[{\"text\":\"网络安全基础\",\"link\":\"/security devices/1\"},{\"text\":\"防火墙基础原理\",\"link\":\"/security devices/2\"},{\"text\":\"防火墙NAT\",\"link\":\"/security devices/3\"},{\"text\":\"防火墙高可靠性技术\",\"link\":\"/security devices/4\"},{\"text\":\"防火墙用户管理技术\",\"link\":\"/security devices/5\"},{\"text\":\"加解密及PKI\",\"link\":\"/security devices/6\"},{\"text\":\"VPN\",\"link\":\"/security devices/7\"},{\"text\":\"防火墙流量管理\",\"link\":\"/security devices/8\"},{\"text\":\"防火墙虚拟系统\",\"link\":\"/security devices/9\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/yage-zhu\"}],\"footer\":{\"copyright\":\"Copyright © 2024-present <a href=\\\"mailto:xuzn@msn.com\\\">xuzn@msn.com</a>\"}},\"locales\":{\"root\":{\"label\":\"中文\",\"lang\":\"zh\"},\"en\":{\"label\":\"English\",\"lang\":\"en\",\"link\":\"/en\",\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"web developer\",\"items\":[{\"text\":\"HTML\",\"link\":\"/html/1\"},{\"text\":\"CSS\",\"link\":\"/css/1\"},{\"text\":\"JavaScript\",\"link\":\"/javascript/1\"},{\"text\":\"ajax\",\"link\":\"/ajax/1\"},{\"text\":\"less and scss\",\"link\":\"/less and scss/1\"},{\"text\":\"TypeScript\",\"link\":\"/typescript/1\"},{\"text\":\"Vue3\",\"link\":\"/vue3/1\"},{\"text\":\"How the browser works\",\"link\":\"/browser/1\"}]},{\"text\":\"Security\",\"items\":[{\"text\":\"Kali\",\"link\":\"/kali/1\"},{\"text\":\"Network Security\",\"link\":\"/network security/1\"},{\"text\":\"Security Devices\",\"link\":\"/security devices/1\"}]},{\"text\":\"Python\",\"link\":\"/python/1\"},{\"text\":\"Nodejs\",\"link\":\"/nodejs/1\"},{\"text\":\"Git\",\"link\":\"/git/1\"},{\"text\":\"Linux\",\"link\":\"/linux/1\"}]}}},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>