import{_ as s,c as i,o as a,a3 as n}from"./chunks/framework.7ep0oyv4.js";const l="/assets/Fs4xqNjf9thyUW7.CSRcH95B.png",c=JSON.parse('{"title":"VPN","description":"","frontmatter":{},"headers":[],"relativePath":"security devices/7.md","filePath":"security devices/7.md"}'),p={name:"security devices/7.md"},h=n('<h1 id="vpn" tabindex="-1">VPN <a class="header-anchor" href="#vpn" aria-label="Permalink to &quot;VPN&quot;">​</a></h1><h2 id="ipsec" tabindex="-1">IPsec <a class="header-anchor" href="#ipsec" aria-label="Permalink to &quot;IPsec&quot;">​</a></h2><p>IPSec VPN:最常见的部署为Site To Site,运行在企业的两个出口设备之间，直接把企业的两个或者多个内网打通</p><p>IKEV1简单说说协商过程：</p><p>阶段一：协商出加密和解密后续消息（协商包）所需的安全参数(SA，安全关联)，使用UDP 500数据连接。</p><ul><li>认证方式</li><li>加密算法</li><li>对端地址</li></ul><p>阶段二：协商出封装和解封装实际数据所需的安全参数(SA，安全关联)</p><ul><li>加密算法：DES3、DES、 AES、SM1、SM2 等 -- 私密性</li><li>完整性校验算法：MD5、SHA等 -- 完整性</li><li>认证方式：PSK预共享密钥/数字证书 -- 源认证</li><li>定义感兴趣流：匹配出需要走VPN通道的流量</li><li>封装协议：ESP/AH</li><li>是否自动触发协商</li></ul><p>业务数据传输安全传输</p><blockquote><p>阶段一是为了保障阶段二协商的安全，阶段二是为了保障后续实际数据的安全。</p></blockquote><p><img src="'+l+`" alt="image-20231029154227353" loading="lazy"></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ike</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proposal</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #ike提议，自带默认参数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ike</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> peer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FW2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       #ike对等体，对端地址</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pre-shared-key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Huawei@123</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   #预共享密钥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ike-proposal</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             #关联ike提议</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> remote-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200.1.1.2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #对端地址</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ipsec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proposal</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #ipsec提议，自带默认参数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">acl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> number</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              #感兴趣列表，匹配哪些走vpn</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> permit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> source</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0.0.255</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.2.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0.0.255</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ipsec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> policy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yageVPN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> isakmp</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #自动安全策略</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> security</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> acl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #关联acl列表</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ike-peer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FW2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         #关联阶段1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> proposal</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          #关联阶段2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sa</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trigger-mode</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      #sa自动触发协商</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">int</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> g1/0/1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ipsec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> policy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yageVPN</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #接口调用策略</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#放行ISAKMP流量，udp500</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">security-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ISAKMP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> untrust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> untrust</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> local</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100.1.1.2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200.1.1.2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100.1.1.2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200.1.1.2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protocol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> udp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> source-port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 500</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination-port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 500</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> esp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> permit</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#防火墙先匹配nat流量，就不会执行后续VPN流量，让VPN流量不执行nat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NoNat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> untrust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.2.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no-nat</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #这段流量不执行nat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> move</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NoNat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> top</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   #规则移动到顶部</span></span></code></pre></div><h2 id="ssl-vpn" tabindex="-1">SSL VPN <a class="header-anchor" href="#ssl-vpn" aria-label="Permalink to &quot;SSL VPN&quot;">​</a></h2><p>运行在客户端(PC)和企业出口之间的，进行移动用户远程接入</p><ul><li><p>创建用户：对象 -- 用户</p></li><li><p>创建资源：网络 -- SSL VPN -- 新建</p><ul><li>Web代理：允许用户访问企业内部网站资源</li><li>文件共享：允许用户访问企业内部文件服务器（SMB共享文件夹）</li><li>端口转发：RDP、Telnet、SSH、FTP、POP3等</li><li>以上三个功能属于代理模型，流量从 用户--FW，FW--服务器，2个tcp连接，<strong>防火墙需要放行两段流量</strong></li><li>网络扩展：允许用户访问企业内部IP网段的资源</li></ul></li><li><p>资源授权：</p><ul><li>把 账号 和 资源 做绑定</li></ul></li><li><p>安全策略放行流量</p></li></ul>`,15),k=[h];function t(e,F,r,d,g,y){return a(),i("div",null,k)}const B=s(p,[["render",t]]);export{c as __pageData,B as default};
