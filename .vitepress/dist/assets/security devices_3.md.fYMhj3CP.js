import{_ as s,c as i,o as a,a3 as n}from"./chunks/framework.7ep0oyv4.js";const t="/assets/zkFmto57HxXMu2Z.LWfIIyu-.png",h="/assets/qSYOKTF6jrQxeyc.DYGloCPH.png",l="/assets/IpMoWNqTFuZ8H2e.kdlFE3sW.png",B=JSON.parse('{"title":"防火墙NAT","description":"","frontmatter":{},"headers":[],"relativePath":"security devices/3.md","filePath":"security devices/3.md"}'),p={name:"security devices/3.md"},k=n('<h1 id="防火墙nat" tabindex="-1">防火墙NAT <a class="header-anchor" href="#防火墙nat" aria-label="Permalink to &quot;防火墙NAT&quot;">​</a></h1><p><img src="'+t+`" alt="image-20231031164721842" loading="lazy"></p><h2 id="源nat" tabindex="-1">源NAT <a class="header-anchor" href="#源nat" aria-label="Permalink to &quot;源NAT&quot;">​</a></h2><ul><li>NAT No-PAT（No-Port Address Translation，非端口地址转换）是一种 <strong>只转换地址，不转换端口</strong>，实现私网地址与公网地址一对一的地址转换方式，产生server-map表。 <ul><li><p>静态nat：只能一对一，一台主机对应一条公网地址，并没有起到节省公网ip的作用</p></li><li><p>动态nat：使用公有地址池，并以先到先得的原则分配这些地址。当数据会话结束后，释放地址回地址池。</p></li></ul></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no-pat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> local</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      #local就是流量受安全策略控制</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> section</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1.1.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SNAT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> source-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> destination-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> untrust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> source-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mask</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255.255.255.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> source-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span></span></code></pre></div><ul><li>NAPT/PAT：（Network Address and Port Translation，网络地址端口转换）是一种 <strong>同时转换地址和端口</strong>，实现多个私网地址共用一个或多个公网地址的地址转换方式，不会产生server-map</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> section</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1.1.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SNAT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> source-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> destination-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> untrust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> source-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mask</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255.255.255.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> source-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span></span></code></pre></div><ul><li>Easy IP ：Easy IP是一种特殊的NAPT，Easy IP使用出接口的公网IP地址作为NAT转换后的地址。</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SNAT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> source-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> destination-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> untrust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> source-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mask</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255.255.255.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> source-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> easy-ip</span></span></code></pre></div><h2 id="目的nat" tabindex="-1">目的Nat <a class="header-anchor" href="#目的nat" aria-label="Permalink to &quot;目的Nat&quot;">​</a></h2><h3 id="nat-server" tabindex="-1">nat server <a class="header-anchor" href="#nat-server" aria-label="Permalink to &quot;nat server&quot;">​</a></h3><p>NAT Server：是一种特殊的静态目的NAT，NAT Server将发往私网服务器的报文中的公网地址转换为与之对应的私网地址</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HTTP_Server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protocol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> global</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200.1.1.11</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inside</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span></code></pre></div><blockquote><p>当NAT公网地址和出接口不在一个网段的时候，可能会导致数据在出口防火墙和运营商路由器之间成环，必须配置黑洞路由</p><p>当NAT公网地址和出接口在一个网段的时候，可能会导致防火墙产生大量的p,建议配置黑洞路由</p><p>当NAT公网地址和出接口一致的时候，不需要配置黑洞路由，不会产生大量arp，也不会导致数据成环</p></blockquote><h3 id="静态目的nat" tabindex="-1">静态目的nat <a class="header-anchor" href="#静态目的nat" aria-label="Permalink to &quot;静态目的nat&quot;">​</a></h3><p>静态目的NAT是一种转换报文目的IP地址的方式，转换前后的地址存在一种固定的映射关系</p><ul><li>公网地址 与 私网地址 一对一映射</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#配置目的nat地址池</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">destination-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> section</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> untrust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> range</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1.1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1.1.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-to-address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yage</span></span></code></pre></div><ul><li>公网端口 与 私网端口 一对一映射</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">destination-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> section</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> untrust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1.1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protocol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination-port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 443</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-to-port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yage</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 443</span></span></code></pre></div><ul><li>公网端口 与 私网地址 一对一映射 <ul><li>访问公网地址不同端口 映射 不同私网地址相同端口</li></ul></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">destination-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> section</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> untrust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1.1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protocol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination-port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 443</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-to-address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yage</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span></code></pre></div><ul><li>公网地址 与 私网端口 一对一映射 <ul><li>访问不同公网地址 映射 相同私网地址不同端口</li></ul></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">destination-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> section</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> untrust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1.1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1.1.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protocol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination-port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-to-port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yage</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 81</span></span></code></pre></div><h3 id="动态目的nat" tabindex="-1">动态目的nat <a class="header-anchor" href="#动态目的nat" aria-label="Permalink to &quot;动态目的nat&quot;">​</a></h3><p>转换前后没有固定的映射，一般用于对流量的重定向</p><p>比如原本去往114.114.114.114的dns解析，重定向到8.8.8.8</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DNS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source0zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 114.114.114.114</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protocol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> udp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination-port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 53</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> source-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> easy-ip</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8.8.8.8</span></span></code></pre></div><h2 id="双向nat" tabindex="-1">双向nat <a class="header-anchor" href="#双向nat" aria-label="Permalink to &quot;双向nat&quot;">​</a></h2><p>场景一：内网服务器不需要上网，<strong>不配置网关</strong>，为了能正常对外提供服务，需要防火墙做双向NAT</p><p><img src="`+h+`" alt="image-20231027223428562" loading="lazy"></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add_group1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #源地址池</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> section</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.100</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #开启黑洞路由</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">destination-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add_group2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   #目的地址池</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> section</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> policy_nat1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> untrust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1.1.10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ftp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> source-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add_group1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> destination-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-to-address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address-group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add_group2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route-static</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1.1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> null0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #黑洞路由防止环路</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> detect</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ftp</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               #开启ftp协议的nat ALG功能</span></span></code></pre></div><p>场景二：内网主机通过公网IP地址访问内网服务器，为了让TCP三次握手成功建立，需要访问做双向NAT</p><p>host通过公网地址访问，tcp第一个包syn发给FW，FW nat转换目的地址发给server，server和host在一个网段，直接发给host syn+ack，存在流量异步问题，导致不能访问。</p><p><img src="`+l+`" alt="image-20231027224916505" loading="lazy"></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> protocol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> global</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.1.1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inside</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.1.1.100</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nat-policy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> easy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-zone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  destination-zon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trust</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  source-address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> source-nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> easy-ip</span></span></code></pre></div>`,36),e=[k];function F(r,d,g,C,y,o){return a(),i("div",null,e)}const u=s(p,[["render",F]]);export{B as __pageData,u as default};
